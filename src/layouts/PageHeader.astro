---
import { twMerge } from "tailwind-merge";
import Kopfzeile from "@layouts/Kopfzeile.astro";
import Link from "@components/Link.astro";
import { Icon } from "astro-icon/components";
import { removeTrailingSlash } from "@utils/routesHelper";
import { ZFL_EMAIL, ZFL_PHONE } from "@config/constants";
import bundLogo from "@images/logo/bund-logo.png";
import { Image } from "astro:assets";

const headerItems = [
  { url: "/begleitungen", title: "Begleitungen" },
  { url: "/schulungen", title: "Schulungen" },
];

const { pathname } = Astro.url;
const currentPath = removeTrailingSlash(pathname);

const basicLinkClasses = "flex items-center hover:bg-zfl-main20";
const activeClasses = "border-zfl-main80 bg-zfl-main20";
---

<header
  class="relative"
  x-data="{ mobileMenuOpen: false }"
  @resize.window="mobileMenuOpen = false"
>
  <Kopfzeile className="relative z-30" />
  <div
    class="border-zfl-main20 relative z-30 flex h-[72px] justify-between border-b-2 bg-white pl-16 md:px-16"
  >
    <!-- Logo and title -->
    <a href={{ url: "/" }.url} class="flex items-center space-x-8">
      <Image src={bundLogo} alt="Logo des Bundes" class="w-56" />
      <p
        class="ds-label-01-bold ml-16 flex flex-col text-xl text-black max-lg:hidden"
      >
        Zentrum für Legistik
      </p>
    </a>

    <!-- Desktop Navigation -->
    <nav class="flex items-center max-md:hidden" data-testid="desktop-nav">
      {
        headerItems.map((item) => (
          <a
            href={item.url}
            class={twMerge(
              basicLinkClasses,
              "ds-label-01-reg relative h-full border-b-4 border-transparent px-16 whitespace-nowrap",
              currentPath === item.url && activeClasses,
            )}
          >
            {item.title}
          </a>
        ))
      }
      <div class="ds-label-01-reg px-16 text-nowrap text-gray-800">
        Kontakt:{" "}
        <Link href={ZFL_EMAIL.url} class="ds-link-01-reg"
          >{ZFL_EMAIL.display}</Link
        >
      </div>
    </nav>

    <!-- Mobile View Controls -->
    <div class="flex items-center space-x-16 md:hidden">
      <a
        href={ZFL_PHONE.url}
        class="border-b-4 border-transparent"
        aria-label={ZFL_PHONE.display}
      >
        <Icon
          name="material-symbols:phone-enabled-outline"
          class="size-24 -scale-x-100"
        />
      </a>
      <button
        class="hover:bg-zfl-main20 aria-expanded:border-zfl-main80 aria-expanded:bg-zfl-main20 h-full border-b-4 border-transparent px-16"
        @click="mobileMenuOpen = !mobileMenuOpen"
        aria-label="Menü öffnen / schließen"
        :aria-expanded="mobileMenuOpen"
        aria-controls="mobile-menu"
      >
        <Icon
          x-show="!mobileMenuOpen"
          name="material-symbols:menu"
          class="size-24"
        />
        <Icon
          x-show="mobileMenuOpen"
          name="material-symbols:menu-open"
          class="size-24"
          style="display: none;"
        />
      </button>
    </div>
  </div>
  <!-- Mobile Navigation -->
  <nav
    id="mobile-menu"
    class="absolute right-0 left-0 z-20 bg-white drop-shadow-[4px_4px_12px_rgba(0,0,0,0.06)]"
    x-show="mobileMenuOpen"
    style="display: none;"
    :aria-hidden="!mobileMenuOpen"
  >
    {
      headerItems.map((item) => (
        <a
          href={item.url}
          class={twMerge(
            basicLinkClasses,
            "ds-label-01-reg border-l-4 border-transparent p-16",
            currentPath === item.url && activeClasses,
          )}
        >
          {item.title}
        </a>
      ))
    }
    <div class="ds-label-01-reg ml-4 p-16 text-gray-800">
      Kontakt:{" "}
      <Link href={ZFL_EMAIL.url} class="ds-link-01-reg"
        >{ZFL_EMAIL.display}</Link
      >
    </div>
  </nav>
  <noscript>
    <div class="bg-yellow-200">
      <div class="breakout-grid py-4">
        <p>
          <strong>Menü funktioniert nicht?</strong> Erlauben Sie JavaScript in den
          Browsereinstellungen oder navigieren Sie über den <Link href="#footer"
            >Footer</Link
          >.
        </p>
      </div>
    </div>
  </noscript>
</header>

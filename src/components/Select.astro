---
interface Props {
  label: string;
  options: string[];
  name?: string;
}
const { label, options, name = "select" } = Astro.props;
---

<div class="w-full">
  <div class="mb-8">{label}</div>
  <div class="custom-select">
    <details class="select-details">
      <summary
        class="select-summary border-cosmic-blue-base border-2 px-24 py-12"
      >
        <span class="selected-value">Bitte w√§hlen</span>
      </summary>
      <ul class="select-options">
        {
          options.map((option) => (
            <li>
              <input
                type="radio"
                name={name}
                value={option}
                id={`${name}-${option.replace(/\s+/g, "-").toLowerCase()}`}
                class="option-radio"
              />
              <label
                for={`${name}-${option.replace(/\s+/g, "-").toLowerCase()}`}
                class="option-label"
              >
                {option}
              </label>
            </li>
          ))
        }
      </ul>
    </details>
  </div>
</div>

<style>
  .custom-select {
    position: relative;
    width: 100%;
  }

  .select-details {
    width: 100%;
  }

  .select-summary {
    cursor: pointer;
    background-color: white;
    list-style: none;
    outline: none;
    position: relative;
    user-select: none;
    transition: box-shadow 0.15s ease;
  }

  .select-summary::-webkit-details-marker {
    display: none;
  }

  .select-summary::marker {
    display: none;
  }

  .select-summary::after {
    content: "";
    position: absolute;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
    width: 0;
    height: 0;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-top: 6px solid currentColor;
    transition: transform 0.2s ease;
  }

  .select-details[open] .select-summary {
    box-shadow: inset 0 0 0 2px var(--color-cosmic-blue-base);
  }

  .select-details[open] .select-summary::after {
    transform: translateY(-50%) rotate(180deg);
  }

  .select-options {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: white;
    margin-top: 4px;
    list-style: none;
    padding: 0;
    box-shadow:
      0 8px 16px -4px rgba(0, 0, 0, 0.15),
      0 4px 8px -2px rgba(0, 0, 0, 0.1);
    z-index: 10;
    max-height: 300px;
    overflow-y: auto;
  }

  .select-options li {
    position: relative;
  }

  .option-radio {
    position: absolute;
    opacity: 0;
    pointer-events: none;
  }

  .option-label {
    display: block;
    padding: 12px 24px;
    cursor: pointer;
    transition: background-color 0.15s ease;
    user-select: none;
  }

  .option-label:hover {
    background-color: rgba(0, 102, 204, 0.1);
  }

  .option-radio:checked + .option-label {
    background-color: var(--color-lavender-400);
    font-weight: 500;
    border-left: 4px solid var(--color-cosmic-blue-base);
    padding-left: 20px;
  }

  .option-radio:focus + .option-label {
    outline: 2px solid rgba(0, 102, 204, 0.5);
    outline-offset: -2px;
  }
</style>

<script>
  document.querySelectorAll(".custom-select").forEach((select) => {
    const details = select.querySelector(
      ".select-details",
    ) as HTMLDetailsElement;
    const summary = select.querySelector(".selected-value") as HTMLElement;
    const radios = select.querySelectorAll(
      ".option-radio",
    ) as NodeListOf<HTMLInputElement>;

    radios.forEach((radio) => {
      radio.addEventListener("change", () => {
        if (radio.checked) {
          summary.textContent = radio.value;
          details.open = false;
        }
      });

      // Also handle label clicks
      const label = radio.nextElementSibling as HTMLElement;
      label?.addEventListener("click", (e) => {
        e.preventDefault();
        radio.checked = true;
        summary.textContent = radio.value;
        setTimeout(() => {
          details.open = false;
        }, 100);
      });
    });
  });
</script>
